version: "3"

networks:
  iudx-net:
    driver: bridge

volumes:
  pgsql-data:
  broker-data:
  elk-data:

services:

  vertx:
    image: ideam/vertx
    container_name: vertx
    hostname: vertx
    restart: always
    hostname: vertx
    ports:
      - "443:8443"
    networks:
      - iudx-net
    cap_add:
      - ALL
    volumes:
      - ../iudx-api-server:/iudx-api-server/
      - ../setup/vertx:/scripts/
    env_file:
      - .env

  broker:
    image: ideam/kore-broker
    container_name: broker 
    restart: always
    hostname: broker
    ports:
      - "5671:5671"
      - "1883:1883"
      - "15672:15672"
    networks:
      - iudx-net
    cap_add:
      - ALL
    volumes:
      - broker-data:/var/lib/rabbitmq/
      - ../authenticator:/authenticator/
      - ../rabbitmq:/etc/rabbitmq/
      - ../setup/broker:/scripts/
    env_file:
      - .env
  
  postgres:
    image: ideam/postgres
    container_name: postgres
    hostname: postgres
    restart: always
    networks:
      - iudx-net
    cap_add:
      - ALL
    volumes:
      - pgsql-data:/var/lib/postgresql
      - ../setup/pgsql:/scripts/
    env_file:
      - .env

  elk:
    image: ideam/elasticsearch
    container_name: elk
    hostname: elk
    ports:
      - "9200:9200"
      - "5601:5601"
    restart: always
    networks:
      - iudx-net
    cap_add:
      - ALL
    volumes:
      - elk-data:/home/ideam/elasticsearch-6.2.4
      - ../setup/elk:/scripts/
    env_file:
      - .env

  dbconnector:
    image: ideam/vertx
    container_name: dbconnector
    hostname: dbconnector
    restart: always
    hostname: dbconnector
    networks:
      - iudx-net
    cap_add:
      - ALL
    volumes:
      - ../iudx-dbconnector:/iudx-dbconnector/
      - ../setup/dbconnector:/scripts/
    env_file:
      - .env
